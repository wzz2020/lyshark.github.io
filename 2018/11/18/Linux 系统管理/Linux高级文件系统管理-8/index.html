<!DOCTYPE html>













<html class="theme-next gemini" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">











<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"expandIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Linux 是一套免费使用和自由传播的类Unix操作系统,是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统.它能运行主要的UNIX工具软件、应用程序和网络协议.它支持32位和64位硬件.Linux继承了Unix以网络为核心的设计思想,是一个性能稳定的多用户网络操作系统. 如果您的 Linux 服务器有多个用户经常存取数据时,为了维护所有使用者在硬盘容量的公平使用,磁碟">
<meta name="keywords" content="Linux 系统管理">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux高级文件系统管理(8)">
<meta property="og:url" content="https://www.mkdirs.com/2018/11/18/Linux 系统管理/Linux高级文件系统管理-8/index.html">
<meta property="og:site_name" content="我的个人博客">
<meta property="og:description" content="Linux 是一套免费使用和自由传播的类Unix操作系统,是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统.它能运行主要的UNIX工具软件、应用程序和网络协议.它支持32位和64位硬件.Linux继承了Unix以网络为核心的设计思想,是一个性能稳定的多用户网络操作系统. 如果您的 Linux 服务器有多个用户经常存取数据时,为了维护所有使用者在硬盘容量的公平使用,磁碟">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-04-16T12:35:22.913Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux高级文件系统管理(8)">
<meta name="twitter:description" content="Linux 是一套免费使用和自由传播的类Unix操作系统,是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统.它能运行主要的UNIX工具软件、应用程序和网络协议.它支持32位和64位硬件.Linux继承了Unix以网络为核心的设计思想,是一个性能稳定的多用户网络操作系统. 如果您的 Linux 服务器有多个用户经常存取数据时,为了维护所有使用者在硬盘容量的公平使用,磁碟">



  <link rel="alternate" href="/atom.xml" title="我的个人博客" type="application/atom+xml">




  <link rel="canonical" href="https://www.mkdirs.com/2018/11/18/Linux 系统管理/Linux高级文件系统管理-8/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Linux高级文件系统管理(8) | 我的个人博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">我的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.mkdirs.com/2018/11/18/Linux 系统管理/Linux高级文件系统管理-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王瑞">
      <meta itemprop="description" content="记录点滴技术成长之路">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Linux高级文件系统管理(8)

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-11-18 16:06:15" itemprop="dateCreated datePublished" datetime="2018-11-18T16:06:15+08:00">2018-11-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 20:35:22" itemprop="dateModified" datetime="2019-04-16T20:35:22+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux-系统管理/" itemprop="url" rel="index"><span itemprop="name">Linux 系统管理</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    
    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>Linux 是一套免费使用和自由传播的类Unix操作系统,是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统.它能运行主要的UNIX工具软件、应用程序和网络协议.它支持32位和64位硬件.Linux继承了Unix以网络为核心的设计思想,是一个性能稳定的多用户网络操作系统.</p>
<p>如果您的 Linux 服务器有多个用户经常存取数据时,为了维护所有使用者在硬盘容量的公平使用,磁碟配额 (Quota) 就是一项非常有用的工具,另外,如果你的用户常常抱怨磁盘容量不够用,那么更进阶的文件系统就得要学习,本章我们会介绍磁盘阵列 (RAID),及逻辑卷轴文件系统 (LVM),这些工具都可以帮助你管理与维护使用者可用的磁盘容量.</p>
<a id="more"></a>
<p><br></p>
<h2 id="Quota-磁盘配额配置"><a href="#Quota-磁盘配额配置" class="headerlink" title="Quota 磁盘配额配置"></a>Quota 磁盘配额配置</h2><p>Quota 这个玩意儿就字面上的意思来看,就是有多少『限额』的意思啦,如果是用在零用钱上面,就是类似『有多少零用钱一个月』的意思之类的,如果是在计算机主机的磁盘使用量上呢? 以 Linux 来说,就是有多少容量限制的意思,我们可以使用 quota 来让磁盘的容量使用较为公平,下面我们会介绍什么是 quota 然后以一个完整的范例来介绍 quota 的使用作用.</p>
<p>由于Linux是一个多用户管理的操作系统，而Linux默认情况下并不限制每个用户使用磁盘空间的大小，假如某个用户疏忽或者恶意占满磁盘空间，将导致系统磁盘无法写入甚至崩溃；为了保证系统磁<br>盘的有足够的剩余空间，我们需要对用户和组进行磁盘空间使用限制。</p>
<blockquote>
<p>磁盘配额限制类型：</p>
<blockquote>
<p>⦁ 限制用户和组,对磁盘空间的使用量<br>⦁ 限制用户和组,在磁盘内创建文件的个数</p>
</blockquote>
</blockquote>
<blockquote>
<p>磁盘配额限制级别：</p>
<blockquote>
<p>⦁ 软限制：低级限制,此限制可以突破,突破时会被警告,超出部分会有宽限天数,宽限天数到期后超出部分被清空,软限制不能超过硬限制<br>⦁ 硬限制：绝对限制,此限制不会被突破,达到指定限制后无法使用更多空间<br>⦁ 宽限天数：当有数据超过软限制后,超出部分会被计时,宽限天数到期后超出部分数据将被清空,宽限天数默认是7天<br>注：磁盘配额是针对分区进行设置的,无法实现,”某用户在系统中共计只能使用50MB磁盘空间”,只能设置某用户在/home分区能使用30M这样的限制.切记：磁盘配额是针对分区的!</p>
</blockquote>
</blockquote>
<p>精简模式下没有此命令,执行 yum install -y quota 安装</p>
<h3 id="◆检查内核是否支持配额◆"><a href="#◆检查内核是否支持配额◆" class="headerlink" title="◆检查内核是否支持配额◆"></a>◆检查内核是否支持配额◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat /boot/config-3.10.0-693.el7.x86_64 |grep "CONFIG_QUOTA"</span></span><br><span class="line">CONFIG_QUOTA=y</span><br><span class="line">CONFIG_QUOTA_NETLINK_INTERFACE=y</span><br><span class="line"><span class="comment"># CONFIG_QUOTA_DEBUG is not set</span></span><br><span class="line">CONFIG_QUOTA_TREE=y</span><br><span class="line">CONFIG_QUOTACTL=y</span><br><span class="line">CONFIG_QUOTACTL_COMPAT=y</span><br></pre></td></tr></table></figure>
<h3 id="◆检查指定分区的挂载属性是否满足条件◆"><a href="#◆检查指定分区的挂载属性是否满足条件◆" class="headerlink" title="◆检查指定分区的挂载属性是否满足条件◆"></a>◆检查指定分区的挂载属性是否满足条件◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># dumpe2fs -h /dev/vdb |grep "Default mount options"</span></span><br><span class="line">dumpe2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line"> </span><br><span class="line"><span class="comment">#检查结果中是否包含,usrquota,grpquota两个挂载属性</span></span><br></pre></td></tr></table></figure>
<h3 id="◆quotacheck-生成用户和组的配置文件◆"><a href="#◆quotacheck-生成用户和组的配置文件◆" class="headerlink" title="◆quotacheck 生成用户和组的配置文件◆"></a>◆quotacheck 生成用户和组的配置文件◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># quotacheck --help</span></span><br><span class="line">Utility <span class="keyword">for</span> checking and repairing quota files.</span><br><span class="line">quotacheck [-gucbfinvdmMR] [-F &lt;quota-format&gt;] filesystem|-a</span><br><span class="line"></span><br><span class="line">语法格式：[ quota [选项] [分区名] ]</span><br><span class="line"></span><br><span class="line">        -a      <span class="comment">#扫描/etc/mtab文件中所有启用磁盘配额功能的分区.如果加入此参数,命令后面就不需要加入分区名了</span></span><br><span class="line">        -u      <span class="comment">#建立用户配额的配置文件,即生成aquota.user</span></span><br><span class="line">        -g      <span class="comment">#建立组配额的配置文件,即aquota.group</span></span><br><span class="line">        -v      <span class="comment">#显示扫描过程</span></span><br><span class="line">        -c      <span class="comment">#清除原有的配置文件,重新建立新的配置文件</span></span><br></pre></td></tr></table></figure>
<h3 id="◆edquota-编辑配额文件-设置指定限制大小◆"><a href="#◆edquota-编辑配额文件-设置指定限制大小◆" class="headerlink" title="◆edquota 编辑配额文件,设置指定限制大小◆"></a>◆edquota 编辑配额文件,设置指定限制大小◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># edquota --help</span></span><br><span class="line">edquota: Usage:</span><br><span class="line">        edquota [-rm] [-u] [-F formatname] [-p username] [-f filesystem] username ...</span><br><span class="line">        edquota [-rm] -g [-F formatname] [-p groupname] [-f filesystem] groupname ...</span><br><span class="line">        edquota [-u|g] [-F formatname] [-f filesystem] -t</span><br><span class="line">        edquota [-u|g] [-F formatname] [-f filesystem] -T username|groupname ...</span><br><span class="line"></span><br><span class="line">语法格式：[ edquota [选项] [用户名或组名] ]</span><br><span class="line"></span><br><span class="line">        -u      <span class="comment">#用户名</span></span><br><span class="line">        -g      <span class="comment">#组名</span></span><br><span class="line">        -t      <span class="comment">#设定宽限时间</span></span><br><span class="line">        -p      <span class="comment">#复制磁盘配额规则,不需要每一个用户或者组都手动设置一遍</span></span><br><span class="line">                <span class="comment">#edquota        -p 模板用户     -u 目标用户</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#注：配置文件中所写大小默认单位KB</span></span><br></pre></td></tr></table></figure>
<h3 id="◆启动quota配额管理◆"><a href="#◆启动quota配额管理◆" class="headerlink" title="◆启动quota配额管理◆"></a>◆启动quota配额管理◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># quotaon --help</span></span><br><span class="line">quotaon: Usage:</span><br><span class="line">        quotaon [-guvp] [-F quotaformat] [-x state] -a</span><br><span class="line">        quotaon [-guvp] [-F quotaformat] [-x state] filesys ...</span><br><span class="line"></span><br><span class="line">语法格式：[ quotaon [选项] [分区名] ]</span><br><span class="line"></span><br><span class="line">        -a      <span class="comment">#根据/etc/mtab文件启动所有分区的磁盘配额（不写分区名）</span></span><br><span class="line">        -u      <span class="comment">#启动用户的磁盘配额</span></span><br><span class="line">        -g      <span class="comment">#启动组的磁盘配额</span></span><br><span class="line">        -v      <span class="comment">#显示启动过程信息</span></span><br></pre></td></tr></table></figure>
<h3 id="◆关闭quota配额管理◆"><a href="#◆关闭quota配额管理◆" class="headerlink" title="◆关闭quota配额管理◆"></a>◆关闭quota配额管理◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># quotaoff --help</span></span><br><span class="line">quotaoff: Usage:</span><br><span class="line">        quotaoff [-guvp] [-F quotaformat] [-x state] -a</span><br><span class="line">        quotaoff [-guvp] [-F quotaformat] [-x state] filesys ...</span><br><span class="line"></span><br><span class="line">语法格式：[ quotaoff [选项] [分区名] ]</span><br><span class="line"></span><br><span class="line">        -a      <span class="comment">#根据/etc/mtab文件关闭所有分区的磁盘配额（不写分区名）</span></span><br><span class="line">        -u      <span class="comment">#关闭用户的磁盘配额</span></span><br><span class="line">        -g      <span class="comment">#关闭组的磁盘配额</span></span><br><span class="line">        -v      <span class="comment">#显示关闭过程信息</span></span><br></pre></td></tr></table></figure>
<h3 id="◆quota-查看指定用户和组的配额信息◆"><a href="#◆quota-查看指定用户和组的配额信息◆" class="headerlink" title="◆quota 查看指定用户和组的配额信息◆"></a>◆quota 查看指定用户和组的配额信息◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># quota --hlep</span></span><br><span class="line">quota: unrecognized option <span class="string">'--hlep'</span></span><br><span class="line">quota: Usage: quota [-guqvswim] [-l | [-Q | -A]] [-F quotaformat]</span><br><span class="line">        quota [-qvswim] [-l | [-Q | -A]] [-F quotaformat] -u username ...</span><br><span class="line">        quota [-qvswim] [-l | [-Q | -A]] [-F quotaformat] -g groupname ...</span><br><span class="line">        quota [-qvswugQm] [-F quotaformat] -f filesystem ...</span><br><span class="line"></span><br><span class="line">语法格式：[ quota [选项] [用户名] ]</span><br><span class="line"></span><br><span class="line">        -u      <span class="comment">#用户名</span></span><br><span class="line">        -g      <span class="comment">#组名</span></span><br><span class="line">        -v      <span class="comment">#显示详细信息</span></span><br><span class="line">        -s      <span class="comment">#以常见单位显示大小</span></span><br></pre></td></tr></table></figure>
<h3 id="◆repquota-查看指定分区的磁盘配额◆"><a href="#◆repquota-查看指定分区的磁盘配额◆" class="headerlink" title="◆repquota 查看指定分区的磁盘配额◆"></a>◆repquota 查看指定分区的磁盘配额◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># repquota --help</span></span><br><span class="line">repquota: Utility <span class="keyword">for</span> reporting quotas.</span><br><span class="line">Usage:</span><br><span class="line">repquota [-vugsi] [-c|C] [-t|n] [-F quotaformat] (-a | mntpoint)</span><br><span class="line"></span><br><span class="line">语法格式：[ repquota [选项] [分区名] ]</span><br><span class="line"></span><br><span class="line">        -u      <span class="comment">#查询用户配额</span></span><br><span class="line">        -g      <span class="comment">#查询组配额</span></span><br><span class="line">        -v      <span class="comment">#显示详情</span></span><br><span class="line">        -s      <span class="comment">#以常见单位显示</span></span><br></pre></td></tr></table></figure>
<h3 id="◆setquota-非交互设置磁盘配额命令◆"><a href="#◆setquota-非交互设置磁盘配额命令◆" class="headerlink" title="◆setquota 非交互设置磁盘配额命令◆"></a>◆setquota 非交互设置磁盘配额命令◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># setquota --help</span></span><br><span class="line">setquota: Usage:</span><br><span class="line">  setquota [-u|-g] [-rm] [-F quotaformat] &lt;user|group&gt;</span><br><span class="line">        &lt;block-softlimit&gt; &lt;block-hardlimit&gt; &lt;inode-softlimit&gt; &lt;inode-hardlimit&gt; -a|&lt;filesystem&gt;...</span><br><span class="line">  setquota [-u|-g] [-rm] [-F quotaformat] &lt;-p protouser|protogroup&gt; &lt;user|group&gt; -a|&lt;filesystem&gt;...</span><br><span class="line">  setquota [-u|-g] [-rm] [-F quotaformat] -b [-c] -a|&lt;filesystem&gt;...</span><br><span class="line">  setquota [-u|-g] [-F quotaformat] -t &lt;blockgrace&gt; &lt;inodegrace&gt; -a|&lt;filesystem&gt;...</span><br><span class="line">  setquota [-u|-g] [-F quotaformat] &lt;user|group&gt; -T &lt;blockgrace&gt; &lt;inodegrace&gt; -a|&lt;filesystem&gt;...</span><br><span class="line"></span><br><span class="line">setquota -u 用户名 软(容) 硬(容) 软(数) 硬(数) 分区名</span><br><span class="line"> </span><br><span class="line">注：这样的非交互式的命令更适合写入脚本,而且假如有很多用户的磁盘配额配置相同也可以用复制来实现。</span><br></pre></td></tr></table></figure>
<h3 id="◆磁盘配额小实验◆"><a href="#◆磁盘配额小实验◆" class="headerlink" title="◆磁盘配额小实验◆"></a>◆磁盘配额小实验◆</h3><blockquote>
<p>⦁ 这里有一块未分区的磁盘/dev/sdb,手动分区并格式化.<br>⦁ 将磁盘配额开启,并写入开机自启动列表.<br>⦁ 创建lyshark用户,和temp组.<br>⦁ 配置lyshark的软限制200M,硬限制500M,配置temp组软限制100M,硬限制200M.</p>
</blockquote>
<p>1.检查系统是否支持配额<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cat /boot/config-3.10.0-862.el7.x86_64 |grep "CONFIG_QUOTA"</span></span><br><span class="line">CONFIG_QUOTA=y</span><br><span class="line">CONFIG_QUOTA_NETLINK_INTERFACE=y</span><br><span class="line"><span class="comment"># CONFIG_QUOTA_DEBUG is not set</span></span><br><span class="line">CONFIG_QUOTA_TREE=y</span><br><span class="line">CONFIG_QUOTACTL=y</span><br><span class="line">CONFIG_QUOTACTL_COMPAT=y</span><br></pre></td></tr></table></figure></p>
<p>2.查看磁盘信息<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ll /dev/sd*</span></span><br><span class="line">brw-rw---- 1 root disk 8,  0 6月  24 09:14 /dev/sda</span><br><span class="line">brw-rw---- 1 root disk 8,  1 6月  24 09:14 /dev/sda1</span><br><span class="line">brw-rw---- 1 root disk 8,  2 6月  24 09:14 /dev/sda2</span><br><span class="line">brw-rw---- 1 root disk 8, 16 6月  24 09:14 /dev/sdb</span><br></pre></td></tr></table></figure></p>
<p>3.磁盘分区/dev/sdb,并格式化为ext4格式<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># parted /dev/sdb</span></span><br><span class="line">GNU Parted 3.1</span><br><span class="line">Using /dev/sdb</span><br><span class="line">Welcome to GNU Parted! Type <span class="string">'help'</span> to view a list of commands.</span><br><span class="line">(parted) mkpart</span><br><span class="line">Partition name?  []? sdb1</span><br><span class="line">File system <span class="built_in">type</span>?  [ext2]? ext2</span><br><span class="line">Start? 1M</span><br><span class="line">End? 10000M</span><br><span class="line">(parted) p</span><br><span class="line">Model: VMware, VMware Virtual S (scsi)</span><br><span class="line">Disk /dev/sdb: 10.7GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><span class="line"></span><br><span class="line">Number  Start   End     Size    File system  Name  Flags</span><br><span class="line"> 1      1049kB  10.0GB  9999MB  ext4         sdb1</span><br><span class="line"></span><br><span class="line">(parted) q</span><br><span class="line">Information: You may need to update /etc/fstab.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mkfs.ext4 /dev/sdb1</span></span><br><span class="line"></span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Fragment size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">610800 inodes, 2441216 blocks</span><br><span class="line">122060 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2151677952</span><br><span class="line">75 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8144 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span></span><br><span class="line">Writing inode tables: <span class="keyword">done</span></span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>4.创建挂载点,并挂载设备<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir /sdb1</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/sdb1 /sdb1/</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  8.0G  1.4G  6.7G  17% /</span><br><span class="line">devtmpfs                  98M     0   98M   0% /dev</span><br><span class="line">tmpfs                    110M     0  110M   0% /dev/shm</span><br><span class="line">tmpfs                    110M  5.5M  104M   6% /run</span><br><span class="line">tmpfs                    110M     0  110M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  130M  885M  13% /boot</span><br><span class="line">tmpfs                     22M     0   22M   0% /run/user/0</span><br><span class="line">/dev/sr0                 4.2G  4.2G     0 100% /mnt</span><br><span class="line">/dev/sdb1                9.1G   37M  8.6G   1% /sdb1</span><br></pre></td></tr></table></figure></p>
<p>5.检查分区是否支持配额 (主要看有没有usrquota,grpquota)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># dumpe2fs -h /dev/sdb1 |grep "Default mount options"</span></span><br><span class="line">dumpe2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Default mount options:    user_xattr acl</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/mounts |grep "/dev/sdb1"</span></span><br><span class="line">/dev/sdb1 /sdb1 ext4 rw,relatime,data=ordered 0 0</span><br><span class="line"></span><br><span class="line"><span class="comment">#上面没有看到相关权限,此时我们要重新挂载一下磁盘,加上权限</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mount -o remount,usrquota,grpquota /dev/sdb1</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /proc/mounts |grep "/dev/sdb1"</span></span><br><span class="line">/dev/sdb1 /sdb1 ext4 rw,relatime,quota,usrquota,grpquota,data=ordered 0 0</span><br></pre></td></tr></table></figure></p>
<p>6.设置开机自动挂载分区,并开启配额<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ls -l /dev/disk/by-uuid/</span></span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 10 Sep 21 20:07 13d5ccc2-52db-4aec-963a-f88e8edcf01c -&gt; ../../sda1</span><br><span class="line">lrwxrwxrwx 1 root root  9 Sep 21 20:07 2018-05-03-20-55-23-00 -&gt; ../../sr0</span><br><span class="line">lrwxrwxrwx 1 root root 10 Sep 21 20:07 4604dcf2-da39-455a-9719-e7c5833e566c -&gt; ../../dm-0</span><br><span class="line">lrwxrwxrwx 1 root root 10 Sep 21 20:47 939cbeb8-bc88-44aa-9221-50672111e123 -&gt; ../../sdb1</span><br><span class="line">lrwxrwxrwx 1 root root 10 Sep 21 20:07 f6a4b420-aa6a-4e66-bbb3-c8e8280a099f -&gt; ../../dm-1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Tue Sep 18 09:05:06 2018</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/dev/mapper/centos-root /                       xfs     defaults        0 0</span><br><span class="line">UUID=13d5ccc2-52db-4aec-963a-f88e8edcf01c /boot                   xfs     defaults        0 0</span><br><span class="line">/dev/mapper/centos-swap swap                    swap    defaults        0 0</span><br><span class="line"></span><br><span class="line">UUID=7d7f22ed-466e-4205-8efe-1b6184dc5e1b swap swap defaults 0 0</span><br><span class="line">UUID=939cbeb8-bc88-44aa-9221-50672111e123 /sdb1   ext4   defaults,usrquota,grpquota  0 0</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mount -o remount,usrquota,grpquota /dev/sdb1</span></span><br></pre></td></tr></table></figure></p>
<p>7.生成配额文件 quotackeck -ugv[分区名]<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># quotacheck -ugv /dev/sdb1</span></span><br><span class="line"></span><br><span class="line">quotacheck: Your kernel probably supports journaled quota but you are not using it. Consider switching to journaled quota to avoid running quotacheck after an unclean shutdown.</span><br><span class="line">quotacheck: Scanning /dev/sdb1 [/sdb1] <span class="keyword">done</span></span><br><span class="line">quotacheck: Cannot <span class="built_in">stat</span> old user quota file /sdb1/aquota.user: No such file or directory. Usage will not be subtracted.</span><br><span class="line">quotacheck: Cannot <span class="built_in">stat</span> old group quota file /sdb1/aquota.group: No such file or directory. Usage will not be subtracted.</span><br><span class="line">quotacheck: Cannot <span class="built_in">stat</span> old user quota file /sdb1/aquota.user: No such file or directory. Usage will not be subtracted.</span><br><span class="line">quotacheck: Cannot <span class="built_in">stat</span> old group quota file /sdb1/aquota.group: No such file or directory. Usage will not be subtracted.</span><br><span class="line">quotacheck: Checked 3 directories and 0 files</span><br><span class="line">quotacheck: Old file not found.</span><br><span class="line">quotacheck: Old file not found.</span><br></pre></td></tr></table></figure></p>
<p>8.编辑限制,edquota -ugtp [用户名/组名]</p>
<p>配置lyshark的软限制200M,硬限制500M<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># edquota -u lyshark</span></span><br><span class="line"></span><br><span class="line">Disk quotas <span class="keyword">for</span> user lyshark (uid 1000):</span><br><span class="line"></span><br><span class="line">     ↓文件系统                         软(容量)   硬(容量)    I节点      软(数)   硬(数)</span><br><span class="line">  Filesystem              blocks       soft       hard     inodes     soft     hard</span><br><span class="line">  /dev/sdb1                 0          200M       500M          0        0        0</span><br></pre></td></tr></table></figure></p>
<p>配置temp组软限制100M,硬限制200M.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># edquota -g temp</span></span><br><span class="line"></span><br><span class="line">Disk quotas <span class="keyword">for</span> group temp (gid 1001):</span><br><span class="line">  Filesystem                   blocks       soft       hard     inodes     soft     hard</span><br><span class="line">  /dev/sdb1                         0     102400     204800          0        0        0</span><br></pre></td></tr></table></figure></p>
<p>9.开启配额,quota on/off -augv<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># quotaon -augv</span></span><br><span class="line">/dev/sdb1 [/sdb1]: group quotas turned on</span><br><span class="line">/dev/sdb1 [/sdb1]: user quotas turned on</span><br></pre></td></tr></table></figure></p>
<p>10.查看指定用户或组的配额,quota -ugvs<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># quota -ugvs</span></span><br><span class="line"></span><br><span class="line">Disk quotas <span class="keyword">for</span> user root (uid 0):</span><br><span class="line">     Filesystem   space   quota   <span class="built_in">limit</span>   grace   files   quota   <span class="built_in">limit</span>   grace</span><br><span class="line">      /dev/sdb1     20K      0K      0K               2       0       0</span><br><span class="line">Disk quotas <span class="keyword">for</span> group root (gid 0):</span><br><span class="line">     Filesystem   space   quota   <span class="built_in">limit</span>   grace   files   quota   <span class="built_in">limit</span>   grace</span><br><span class="line">      /dev/sdb1     20K      0K      0K               2       0       0</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="LVM-逻辑卷管理器"><a href="#LVM-逻辑卷管理器" class="headerlink" title="LVM 逻辑卷管理器"></a>LVM 逻辑卷管理器</h2><p>LVM（Logical Volume Manager）逻辑卷管理,它是Linux环境下对磁盘分区进行管理的一种机制,普通的磁盘分区管理方式在分区划分好之后就无法改变其大小,当一个逻辑分区存放不下某个文件时,解决的方法通常是使用符号链接,或者使用调整分区大小的工具,但这只是暂时解决办法,没有从根本上解决问题.简单来说LVM就是将物理磁盘融合成一个或几个大的虚拟磁盘存储池,按照我们的需求去存储池划分空间来使用,由于是虚拟的存储池,所以划分空间时可以自由的调整大小,如下：</p>
<blockquote>
<p>LVM的组成部分：</p>
<blockquote>
<p>⦁ 物理卷（PV，Physical Volume）：由磁盘或分区转化而成<br>⦁ 卷组（VG，Volume Group）：将多个物理卷组合在一起组成了卷组,组成同一个卷组的可以是同一个硬盘的不同分区,也可以是不同硬盘上的不同分区,我们通常把卷组理解为一块硬盘.<br>⦁ 逻辑卷（LV，Logical Volume）：把卷组理解为硬盘的话,那么我们的逻辑卷则是硬盘上的分区,逻辑卷可以进行格式化,存储数据.<br>⦁ 物理扩展（PE，Physical Extend）：PE卷组的最小存储单元,PE所在的位置是VG卷组,即硬盘上,那么我们可以把PE理解为硬盘上的扇区,默认是4MB,可自由配置.</p>
</blockquote>
</blockquote>
<p>这里准备好4块硬盘,无需分区与格式化.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ll /dev/sd[b-z]</span></span><br><span class="line"></span><br><span class="line">brw-rw---- 1 root disk 8, 16 Sep 21 22:04 /dev/sdb</span><br><span class="line">brw-rw---- 1 root disk 8, 32 Sep 21 22:04 /dev/sdc</span><br><span class="line">brw-rw---- 1 root disk 8, 48 Sep 21 22:04 /dev/sdd</span><br><span class="line">brw-rw---- 1 root disk 8, 64 Sep 21 22:04 /dev/sde</span><br></pre></td></tr></table></figure></p>
<h3 id="◆PV-物理卷创建与移除◆"><a href="#◆PV-物理卷创建与移除◆" class="headerlink" title="◆PV 物理卷创建与移除◆"></a>◆PV 物理卷创建与移除◆</h3><p><strong><em>PV的创建</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pvcreate [分区路径],[分区路径][.......]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># ll /dev/sd[b-z]</span></span><br><span class="line">brw-rw---- 1 root disk 8, 16 Sep 21 22:04 /dev/sdb</span><br><span class="line">brw-rw---- 1 root disk 8, 32 Sep 21 22:04 /dev/sdc</span><br><span class="line">brw-rw---- 1 root disk 8, 48 Sep 21 22:04 /dev/sdd</span><br><span class="line">brw-rw---- 1 root disk 8, 64 Sep 21 22:04 /dev/sde</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvcreate /dev/sdb /dev/sdc           #此处拿3块硬盘创建</span></span><br><span class="line">  Physical volume <span class="string">"/dev/sdb"</span> successfully created.</span><br><span class="line">  Physical volume <span class="string">"/dev/sdc"</span> successfully created.</span><br><span class="line">  Physical volume <span class="string">"/dev/sdd"</span> successfully created.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvs                                  #查询创建好的硬盘</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize  PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--  &lt;9.00g     0</span><br><span class="line">  /dev/sdb          lvm2 ---  10.00g 10.00g</span><br><span class="line">  /dev/sdc          lvm2 ---  10.00g 10.00g</span><br><span class="line">  /dev/sdd          lvm2 ---  10.00g 10.00g</span><br></pre></td></tr></table></figure></p>
<p><strong><em>PV的移除</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pvremove [分区路径]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize  PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--  &lt;9.00g     0</span><br><span class="line">  /dev/sdb          lvm2 ---  10.00g 10.00g</span><br><span class="line">  /dev/sdc          lvm2 ---  10.00g 10.00g</span><br><span class="line">  /dev/sdd          lvm2 ---  10.00g 10.00g</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvremove /dev/sdd                       #移除/dev/sdd</span></span><br><span class="line">  Labels on physical volume <span class="string">"/dev/sdd"</span> successfully wiped.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize  PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--  &lt;9.00g     0</span><br><span class="line">  /dev/sdb          lvm2 ---  10.00g 10.00g</span><br><span class="line">  /dev/sdc          lvm2 ---  10.00g 10.00g</span><br></pre></td></tr></table></figure></p>
<h3 id="◆VG-卷组创建与移除◆"><a href="#◆VG-卷组创建与移除◆" class="headerlink" title="◆VG 卷组创建与移除◆"></a>◆VG 卷组创建与移除◆</h3><p><strong><em>创建VG卷组,VG卷组要在PV中选择</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vgcreate -s [指定PE大小] [VG卷组名] [分区路径] [分区路径][.....]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize  PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--  &lt;9.00g     0</span><br><span class="line">  /dev/sdb          lvm2 ---  10.00g 10.00g</span><br><span class="line">  /dev/sdc          lvm2 ---  10.00g 10.00g</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgcreate -s 4M my_vg /dev/sdb /dev/sdc        #此处就是创建一个VG卷组</span></span><br><span class="line">  Volume group <span class="string">"my_vg"</span> successfully created</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgs</span></span><br><span class="line">  VG     <span class="comment">#PV #LV #SN Attr   VSize  VFree</span></span><br><span class="line">  centos   1   2   0 wz--n- &lt;9.00g     0</span><br><span class="line">  my_vg    2   0   0 wz--n- 19.99g 19.99g                         <span class="comment">#这就是VG卷组,名字是my_vg</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>给当前my_vg卷组,添加一块新的PV,也就是扩展卷组</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vgextend [卷组名] [物理卷分区]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize   PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--   &lt;9.00g      0</span><br><span class="line">  /dev/sdb   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line">  /dev/sdc   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line">  /dev/sdd          lvm2 ---   10.00g  10.00g               <span class="comment">#这个物理卷没有划分卷组</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgextend my_vg /dev/sdd                 #添加一个PV到指定卷组</span></span><br><span class="line">  Volume group <span class="string">"my_vg"</span> successfully extended</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize   PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--   &lt;9.00g      0</span><br><span class="line">  /dev/sdb   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line">  /dev/sdc   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line">  /dev/sdd   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g               <span class="comment">#已被划分到my_vg卷组</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>在VG卷组里移除一个PV（移除单个PG）</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vgreduce [卷组名] [物理卷分区]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize   PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--   &lt;9.00g      0</span><br><span class="line">  /dev/sdb   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line">  /dev/sdc   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line">  /dev/sdd   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgreduce my_vg /dev/sdd                #将/dev/sdd从my_vg卷组里移除</span></span><br><span class="line">  Removed <span class="string">"/dev/sdd"</span> from volume group <span class="string">"my_vg"</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># pvs</span></span><br><span class="line">  PV         VG     Fmt  Attr PSize   PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--   &lt;9.00g      0</span><br><span class="line">  /dev/sdb   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line">  /dev/sdc   my_vg  lvm2 a--  &lt;10.00g &lt;10.00g</span><br><span class="line">  /dev/sdd          lvm2 ---   10.00g  10.00g</span><br></pre></td></tr></table></figure></p>
<p><strong><em>移除整个VG卷组</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vgremove [卷组名]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgs</span></span><br><span class="line">  VG     <span class="comment">#PV #LV #SN Attr   VSize  VFree</span></span><br><span class="line">  centos   1   2   0 wz--n- &lt;9.00g     0</span><br><span class="line">  my_vg    2   0   0 wz--n- 19.99g 19.99g</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgremove my_vg                    #移除整个卷组</span></span><br><span class="line">  Volume group <span class="string">"my_vg"</span> successfully removed</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgs</span></span><br><span class="line">  VG     <span class="comment">#PV #LV #SN Attr   VSize  VFree</span></span><br><span class="line">  centos   1   2   0 wz--n- &lt;9.00g    0</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p><strong><em>移除空的物理卷VG</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vgreduce -a [卷组名]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgs</span></span><br><span class="line">  VG     <span class="comment">#PV #LV #SN Attr   VSize   VFree</span></span><br><span class="line">  centos   1   2   0 wz--n-  &lt;9.00g      0</span><br><span class="line">  my_vg    3   0   0 wz--n- &lt;29.99g &lt;29.99g</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgreduce -a my_vg                 #只移除空卷组</span></span><br><span class="line">  Removed <span class="string">"/dev/sdb"</span> from volume group <span class="string">"my_vg"</span></span><br><span class="line">  Removed <span class="string">"/dev/sdc"</span> from volume group <span class="string">"my_vg"</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># vgs</span></span><br><span class="line">  VG     <span class="comment">#PV #LV #SN Attr   VSize   VFree</span></span><br><span class="line">  centos   1   2   0 wz--n-  &lt;9.00g      0</span><br><span class="line">  my_vg    1   0   0 wz--n- &lt;10.00g &lt;10.00g</span><br></pre></td></tr></table></figure></p>
<h3 id="◆LV-逻辑卷创建与移除◆"><a href="#◆LV-逻辑卷创建与移除◆" class="headerlink" title="◆LV 逻辑卷创建与移除◆"></a>◆LV 逻辑卷创建与移除◆</h3><p><strong><em>创建LVM</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lvcreate -L [指定大小] -n [LV名字] [VG卷组:从哪个卷组里划分]</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># lvs</span></span><br><span class="line">  LV   VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root centos -wi-ao---- &lt;8.00g</span><br><span class="line">  swap centos -wi-ao----  1.00g</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># lvcreate -L 10G -n my_lv my_vg            #创建LVM逻辑卷</span></span><br><span class="line">  Logical volume <span class="string">"my_lv"</span> created.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># lvs</span></span><br><span class="line">  LV    VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root  centos -wi-ao---- &lt;8.00g</span><br><span class="line">  swap  centos -wi-ao----  1.00g</span><br><span class="line">  my_lv my_vg  -wi<span class="_">-a</span>----- 10.00g</span><br></pre></td></tr></table></figure></p>
<p><strong><em>格式化并挂载使用</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkdir /LVM                            #首先创建一个挂载点</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mkfs.ext4 /dev/my_vg/my_lv            #格式化LVM分区</span></span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Fragment size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">655360 inodes, 2621440 blocks</span><br><span class="line">131072 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2151677952</span><br><span class="line">80 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span></span><br><span class="line">Writing inode tables: <span class="keyword">done</span></span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/my_vg/my_lv /LVM/                  #挂载LVM</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># df -h                                         #查看结果</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  8.0G  1.2G  6.9G  15% /</span><br><span class="line">devtmpfs                  98M     0   98M   0% /dev</span><br><span class="line">tmpfs                    110M     0  110M   0% /dev/shm</span><br><span class="line">tmpfs                    110M  5.5M  104M   5% /run</span><br><span class="line">tmpfs                    110M     0  110M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  130M  885M  13% /boot</span><br><span class="line">tmpfs                     22M     0   22M   0% /run/user/0</span><br><span class="line">/dev/mapper/my_vg-my_lv  9.8G   37M  9.2G   1% /LVM                ← 挂载成功</span><br></pre></td></tr></table></figure></p>
<h3 id="◆LV-容量增加-将LV的容量增加5G的空间-◆"><a href="#◆LV-容量增加-将LV的容量增加5G的空间-◆" class="headerlink" title="◆LV 容量增加 (将LV的容量增加5G的空间)◆"></a>◆LV 容量增加 (将LV的容量增加5G的空间)◆</h3><p><strong><em>注意：这里扩展,要先扩展LVM,然后再扩展文件系统</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  8.0G  1.2G  6.9G  15% /</span><br><span class="line">devtmpfs                  98M     0   98M   0% /dev</span><br><span class="line">tmpfs                    110M     0  110M   0% /dev/shm</span><br><span class="line">tmpfs                    110M  5.5M  104M   5% /run</span><br><span class="line">tmpfs                    110M     0  110M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  130M  885M  13% /boot</span><br><span class="line">tmpfs                     22M     0   22M   0% /run/user/0</span><br><span class="line">/dev/mapper/my_vg-my_lv  9.8G   37M  9.2G   1% /LVM                  ←此处是10G</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># lvextend -L +5G /dev/my_vg/my_lv                 #执行增加命令,从VG卷组划分5G</span></span><br><span class="line">  Size of logical volume my_vg/my_lv changed from 10.00 GiB (2560 extents) to 15.00 GiB (3840).</span><br><span class="line">  Logical volume my_vg/my_lv successfully resized.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># resize2fs -f /dev/my_vg/my_lv                    #扩展文件系统</span></span><br><span class="line">resize2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem at /dev/my_vg/my_lv is mounted on /LVM; on-line resizing required</span><br><span class="line">old_desc_blocks = 2, new_desc_blocks = 2</span><br><span class="line">The filesystem on /dev/my_vg/my_lv is now 3932160 blocks long.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># df -h                                            #验证扩展结果</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  8.0G  1.2G  6.9G  15% /</span><br><span class="line">devtmpfs                  98M     0   98M   0% /dev</span><br><span class="line">tmpfs                    110M     0  110M   0% /dev/shm</span><br><span class="line">tmpfs                    110M  5.5M  104M   5% /run</span><br><span class="line">tmpfs                    110M     0  110M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  130M  885M  13% /boot</span><br><span class="line">tmpfs                     22M     0   22M   0% /run/user/0</span><br><span class="line">/dev/mapper/my_vg-my_lv   15G   41M   14G   1% /LVM                  ←此处已经从10G 增加到15G</span><br></pre></td></tr></table></figure></p>
<h3 id="◆LV-容量缩小-将LV的容量缩小5G的空间-◆"><a href="#◆LV-容量缩小-将LV的容量缩小5G的空间-◆" class="headerlink" title="◆LV 容量缩小(将LV的容量缩小5G的空间)◆"></a>◆LV 容量缩小(将LV的容量缩小5G的空间)◆</h3><p><strong><em>注意：这里缩小,要卸载文件系统,检查分区,然后缩小文件系统,最后再缩小LVM</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  8.0G  1.2G  6.9G  15% /</span><br><span class="line">devtmpfs                  98M     0   98M   0% /dev</span><br><span class="line">tmpfs                    110M     0  110M   0% /dev/shm</span><br><span class="line">tmpfs                    110M  5.5M  104M   5% /run</span><br><span class="line">tmpfs                    110M     0  110M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  130M  885M  13% /boot</span><br><span class="line">tmpfs                     22M     0   22M   0% /run/user/0</span><br><span class="line">/dev/mapper/my_vg-my_lv   15G   41M   14G   1% /LVM                 ←此处显示15G空间</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># umount /dev/my_vg/my_lv                         #卸载LVM卷组</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># e2fsck -f /dev/my_vg/my_lv                      #检查文件系统</span></span><br><span class="line">e2fsck 1.42.9 (28-Dec-2013)</span><br><span class="line">Pass 1: Checking inodes, blocks, and sizes</span><br><span class="line">Pass 2: Checking directory structure</span><br><span class="line">Pass 3: Checking directory connectivity</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">Pass 5: Checking group summary information</span><br><span class="line">/dev/my_vg/my_lv: 11/983040 files (0.0% non-contiguous), 104724/3932160 blocks</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># resize2fs -f /dev/my_vg/my_lv 10G(减小后的大小)   #缩小文件系统</span></span><br><span class="line">resize2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Resizing the filesystem on /dev/my_vg/my_lv to 2621440 (4k) blocks.</span><br><span class="line">The filesystem on /dev/my_vg/my_lv is now 2621440 blocks long.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># lvreduce -L 10G /dev/my_vg/my_lv                 #缩小LVM</span></span><br><span class="line">  WARNING: Reducing active logical volume to 10.00 GiB.</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce my_vg/my_lv? [y/n]: y                   <span class="comment">#输入y</span></span><br><span class="line">  Size of logical volume my_vg/my_lv changed from 15.00 GiB (3840 extents) to 10.00 GiB (2560).</span><br><span class="line">  Logical volume my_vg/my_lv successfully resized.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/my_vg/my_lv /LVM/                    #挂载</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># df -h                                           #再次查看分区变化</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  8.0G  1.2G  6.9G  15% /</span><br><span class="line">devtmpfs                  98M     0   98M   0% /dev</span><br><span class="line">tmpfs                    110M     0  110M   0% /dev/shm</span><br><span class="line">tmpfs                    110M  5.5M  104M   5% /run</span><br><span class="line">tmpfs                    110M     0  110M   0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  130M  885M  13% /boot</span><br><span class="line">tmpfs                     22M     0   22M   0% /run/user/0</span><br><span class="line">/dev/mapper/my_vg-my_lv  9.8G   37M  9.2G   1% /LVM                 ←此处已经从15G变成10G</span><br></pre></td></tr></table></figure></p>
<h3 id="◆LV-快照功能◆"><a href="#◆LV-快照功能◆" class="headerlink" title="◆LV 快照功能◆"></a>◆LV 快照功能◆</h3><p><strong><em>拍摄快照</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">lvcreate [-s 快照] -n [快照名] -L [快照大小] [指定分区] </span><br><span class="line"></span><br><span class="line">[root@localhost LVM]<span class="comment"># ls</span></span><br><span class="line">1    12  16  2   23  27  30  34  38  41  45  49  52  56  6   63  67  70  74  78  81  85  89  92  96</span><br><span class="line">10   13  17  20  24  28  31  35  39  42  46  5   53  57  60  64  68  71  75  79  82  86  9   93  97</span><br><span class="line">100  14  18  21  25  29  32  36  4   43  47  50  54  58  61  65  69  72  76  8   83  87  90  94  98</span><br><span class="line">11   15  19  22  26  3   33  37  40  44  48  51  55  59  62  66  7   73  77  80  84  88  91  95  99</span><br><span class="line"></span><br><span class="line">[root@localhost LVM]<span class="comment"># lvcreate -s -n mylv_back -L 200M /dev/my_vg/my_lv            #给/LVM目录拍摄快照</span></span><br><span class="line">  Logical volume <span class="string">"mylv_back"</span> created.</span><br><span class="line"></span><br><span class="line">[root@localhost LVM]<span class="comment"># lvs                                                          #查看快照</span></span><br><span class="line">  LV        VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root      centos -wi-ao----  &lt;8.00g</span><br><span class="line">  swap      centos -wi-ao----   1.00g</span><br><span class="line">  my_lv     my_vg  owi-aos---  10.00g</span><br><span class="line">  mylv_back my_vg  swi<span class="_">-a</span><span class="_">-s</span>--- 200.00m      my_lv  0.01                             ←此处就是快照</span><br></pre></td></tr></table></figure></p>
<p><strong><em>快照恢复</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost LVM]<span class="comment"># ls</span></span><br><span class="line">1    12  16  2   23  27  30  34  38  41  45  49  52  56  6   63  67  70  74  78  81  85  89  92  96</span><br><span class="line">10   13  17  20  24  28  31  35  39  42  46  5   53  57  60  64  68  71  75  79  82  86  9   93  97</span><br><span class="line">100  14  18  21  25  29  32  36  4   43  47  50  54  58  61  65  69  72  76  8   83  87  90  94  98</span><br><span class="line">11   15  19  22  26  3   33  37  40  44  48  51  55  59  62  66  7   73  77  80  84  88  91  95  99</span><br><span class="line"></span><br><span class="line">[root@localhost LVM]<span class="comment"># rm -fr *                                #模拟被删除</span></span><br><span class="line">[root@localhost LVM]<span class="comment"># mkdir /back                             #创建挂载点</span></span><br><span class="line">[root@localhost LVM]<span class="comment"># mount /dev/my_vg/mylv_back /back/       #挂载备份文件</span></span><br><span class="line">[root@localhost LVM]<span class="comment"># cp -a /back/* ./                        #复制备份文件</span></span><br><span class="line"></span><br><span class="line">[root@localhost LVM]<span class="comment"># ls</span></span><br><span class="line">1    12  16  2   23  27  30  34  38  41  45  49  52  56  6   63  67  70  74  78  81  85  89  92  96</span><br><span class="line">10   13  17  20  24  28  31  35  39  42  46  5   53  57  60  64  68  71  75  79  82  86  9   93  97</span><br><span class="line">100  14  18  21  25  29  32  36  4   43  47  50  54  58  61  65  69  72  76  8   83  87  90  94  98</span><br><span class="line">11   15  19  22  26  3   33  37  40  44  48  51  55  59  62  66  7   73  77  80  84  88  91  95  99</span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="RAID-独立磁盘冗余阵列"><a href="#RAID-独立磁盘冗余阵列" class="headerlink" title="RAID 独立磁盘冗余阵列"></a>RAID 独立磁盘冗余阵列</h2><p>定义：独立磁盘构成的具有冗余能力的阵列</p>
<p>磁盘阵列分类：一是外接式磁盘阵列柜、二是内接式磁盘阵列卡，三是利用软件来仿真</p>
<p>1.通过把多个磁盘组织在一起作为一个逻辑卷提供磁盘跨越功能<br>2.通过把数据分成多个数据块（Block）并行写入/读出多个磁盘以提高访问磁盘的速度<br>3.通过镜像或校验操作提供容错能力</p>
<p>注意：RAID磁盘阵列主要为了保证硬件损坏的情况下业务不会终止，无法防止误操作</p>
<blockquote>
<p>磁盘阵列的分类</p>
<blockquote>
<p>1.外接式磁盘阵列柜<br>2.内接式磁盘阵列<br>3.利用软件来仿真<br>注意：通常情况下,生产环境中,一般使用硬件RAID来做,这里只做了解即可</p>
</blockquote>
</blockquote>
<blockquote>
<p>RAID磁盘阵列简介</p>
<blockquote>
<p>RAID 0 没有奇偶校验的 (条带卷)<br>RAID 0 提高存储性能的原理是把连续的数据分散到多个磁盘上存取,这样系统有数据请求就可以被多个磁盘并行的执行,每个磁盘执行属于它自己的那部分数据请求</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>RAID 1 独立磁盘冗余阵 (镜像卷)<br>RAID 1 通过磁盘数据镜像实现数据冗余,在成对的独立磁盘上产生互为备份的数据.当原始数据繁忙时,可直接从镜像拷贝中读取数据,因此RAID 1可以提高读取性能.</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>RAID10 (镜象阵列条带)<br>Raid 10 是一个Raid1与Raid0的组合体,它是利用奇偶校验实现条带集镜像,所以它继承了Raid0的快速和Raid1的安全.</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>RAID5 分布式奇偶校验的独立磁盘结构(最少3块)<br>RAID 5 是一种存储性能,数据安全,和存储成本,兼顾的存储解决方案. RAID 5可以理解为是RAID 0和RAID 1的折中方案.</p>
</blockquote>
</blockquote>
<h3 id="◆Mdadm-命令解析◆"><a href="#◆Mdadm-命令解析◆" class="headerlink" title="◆Mdadm 命令解析◆"></a>◆Mdadm 命令解析◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mdadm --help</span></span><br><span class="line">mdadm is used <span class="keyword">for</span> building, managing, and monitoring</span><br><span class="line">Linux md devices (aka RAID arrays)</span><br><span class="line">Usage: mdadm </span><br><span class="line"></span><br><span class="line">mdadm --create --auto=yes /dev/md[0-9] --raid-devices=[0-n] \</span><br><span class="line">--level=[015] --spare-devices=[0-n] /dev/sd[a-z]</span><br><span class="line"></span><br><span class="line">		--create      		 <span class="comment">#新建RAID参数</span></span><br><span class="line">		--auto=yes    		 <span class="comment">#默认配置</span></span><br><span class="line">		--raid-devices=N     <span class="comment">#磁盘阵列数</span></span><br><span class="line">		--spare-devices=N 	 <span class="comment">#备份磁盘数</span></span><br><span class="line">		--level [015] 		 <span class="comment">#阵列等级</span></span><br><span class="line">		mdadm --detail       <span class="comment">#查询阵列信息</span></span><br></pre></td></tr></table></figure>
<h3 id="◆构建一个RAID-5◆"><a href="#◆构建一个RAID-5◆" class="headerlink" title="◆构建一个RAID 5◆"></a>◆构建一个RAID 5◆</h3><p><strong><em>注意：精简模式下,没有安装此命令,执行 yum install -y mdadm 安装</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># ls -l /dev/sd[b-z]</span></span><br><span class="line">brw-rw---- 1 root disk 8, 16 Sep 21 23:06 /dev/sdb</span><br><span class="line">brw-rw---- 1 root disk 8, 32 Sep 21 23:06 /dev/sdc</span><br><span class="line">brw-rw---- 1 root disk 8, 48 Sep 21 23:06 /dev/sdd</span><br><span class="line">brw-rw---- 1 root disk 8, 64 Sep 21 23:04 /dev/sde</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mdadm --create --auto=yes /dev/md0 --level=5 \</span></span><br><span class="line">&gt; --raid-devices=3 --spare-devices=1 /dev/sd&#123;b,c,d,e&#125;                  <span class="comment">#创建一个RAID,其中接口是/dev/md0,等级是RAID5</span></span><br><span class="line">mdadm: Defaulting to version 1.2 metadata                              <span class="comment">#主磁盘数3,备份盘数1,提供sd&#123;b,c,d,e&#125;磁盘</span></span><br><span class="line">mdadm: array /dev/md0 started.</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mdadm --detail /dev/md0                            #查看阵列信息</span></span><br><span class="line">/dev/md0:   ←设备文件名</span><br><span class="line">           Version : 1.2</span><br><span class="line">     Creation Time : Fri Sep 21 23:19:09 2018   ←创建日期</span><br><span class="line">        Raid Level : raid5                      ←RAID等级</span><br><span class="line">        Array Size : 20953088 (19.98 GiB 21.46 GB)  ←可用空间</span><br><span class="line">     Used Dev Size : 10476544 (9.99 GiB 10.73 GB)   ←每个设备可用空间</span><br><span class="line">      Raid Devices : 3       ←RAID设备数量</span><br><span class="line">     Total Devices : 4       ←全部设备数量</span><br><span class="line">       Persistence : Superblock is persistent</span><br><span class="line"></span><br><span class="line">       Update Time : Fri Sep 21 23:19:26 2018</span><br><span class="line">             State : clean, degraded, recovering</span><br><span class="line">    Active Devices : 3   ←启动磁盘</span><br><span class="line">   Working Devices : 4   ←可用磁盘</span><br><span class="line">    Failed Devices : 0   ←错误磁盘</span><br><span class="line">     Spare Devices : 1   ←预备磁盘</span><br><span class="line"></span><br><span class="line">            Layout : left-symmetric</span><br><span class="line">        Chunk Size : 512K</span><br><span class="line"></span><br><span class="line">Consistency Policy : resync</span><br><span class="line"></span><br><span class="line">    Rebuild Status : 34% complete</span><br><span class="line"></span><br><span class="line">              Name : localhost.localdomain:0  (<span class="built_in">local</span> to host localhost.localdomain)</span><br><span class="line">              UUID : 2ee2bcd5:c5189354:d3810252:23c2d5a8   ←此设备UUID</span><br><span class="line">            Events : 6</span><br><span class="line"></span><br><span class="line">    Number   Major   Minor   RaidDevice State</span><br><span class="line">       0       8       16        0      active sync   /dev/sdb</span><br><span class="line">       1       8       32        1      active sync   /dev/sdc</span><br><span class="line">       4       8       48        2      spare rebuilding   /dev/sdd</span><br><span class="line"></span><br><span class="line">       3       8       64        -      spare   /dev/sde</span><br></pre></td></tr></table></figure></p>
<p><strong><em>格式化 /dev/md0并挂载使用</em></strong><br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># mkfs -t ext4 /dev/md0             #格式化</span></span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Filesystem label=</span><br><span class="line">OS <span class="built_in">type</span>: Linux</span><br><span class="line">Block size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Fragment size=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=128 blocks, Stripe width=256 blocks</span><br><span class="line">1310720 inodes, 5238272 blocks</span><br><span class="line">261913 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">First data block=0</span><br><span class="line">Maximum filesystem blocks=2153775104</span><br><span class="line">160 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks:</span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,</span><br><span class="line">        4096000</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span></span><br><span class="line">Writing inode tables: <span class="keyword">done</span></span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir /RAID              #新建挂载目录</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/md0 /RAID/    #挂载设备</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem               Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/centos-root  8.0G  1.2G  6.9G  15% /</span><br><span class="line">devtmpfs                  98M     0   98M   0% /dev</span><br><span class="line">/dev/sr0                 4.2G  4.2G     0 100% /mnt</span><br><span class="line">/dev/md0                  20G   45M   19G   1% /RAID    ←此处可看到挂载成功</span><br></pre></td></tr></table></figure></p>
<h3 id="◆RAID-仿真救援模式◆"><a href="#◆RAID-仿真救援模式◆" class="headerlink" title="◆RAID 仿真救援模式◆"></a>◆RAID 仿真救援模式◆</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mdadm --manage /dev/md[0-9] --add 设备 --remove 设备 --fail 设备</span><br><span class="line"></span><br><span class="line">	--add     <span class="comment">#将后面的设备加入md中</span></span><br><span class="line">	--remove  <span class="comment">#移除设备</span></span><br><span class="line">	--fail    <span class="comment">#设置出错磁盘</span></span><br><span class="line">------------------------------------------------------------</span><br><span class="line">[实验]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost /]<span class="comment"># mdadm --manage /dev/md0 --fail /dev/sdb         #将/dev/sdb标注为错误</span></span><br><span class="line">mdadm: <span class="built_in">set</span> /dev/sdb faulty <span class="keyword">in</span> /dev/md0</span><br><span class="line"></span><br><span class="line">[root@localhost /]<span class="comment"># mdadm --detail /dev/md0                         #查看一下状态</span></span><br><span class="line">/dev/md0:</span><br><span class="line">           Version : 1.2</span><br><span class="line">     Creation Time : Fri Sep 21 23:19:09 2018</span><br><span class="line">        Raid Level : raid5</span><br><span class="line">        Array Size : 20953088 (19.98 GiB 21.46 GB)</span><br><span class="line">     Used Dev Size : 10476544 (9.99 GiB 10.73 GB)</span><br><span class="line">      Raid Devices : 3</span><br><span class="line">     Total Devices : 4</span><br><span class="line">       Persistence : Superblock is persistent</span><br><span class="line"></span><br><span class="line">       Update Time : Fri Sep 21 23:50:12 2018</span><br><span class="line">             State : clean, degraded, recovering</span><br><span class="line">    Active Devices : 2</span><br><span class="line">   Working Devices : 3</span><br><span class="line">    Failed Devices : 1  ← 出错磁盘一个</span><br><span class="line">     Spare Devices : 1</span><br><span class="line"></span><br><span class="line">            Layout : left-symmetric</span><br><span class="line">        Chunk Size : 512K</span><br><span class="line"></span><br><span class="line">Consistency Policy : resync</span><br><span class="line"></span><br><span class="line">    Rebuild Status : 5% complete     ←此处需要注意,他正在恢复数据,等到100%时又可以正常工作</span><br><span class="line"></span><br><span class="line">              Name : localhost.localdomain:0  (<span class="built_in">local</span> to host localhost.localdomain)</span><br><span class="line">              UUID : 2ee2bcd5:c5189354:d3810252:23c2d5a8</span><br><span class="line">            Events : 20</span><br><span class="line"></span><br><span class="line">    Number   Major   Minor   RaidDevice State</span><br><span class="line">       3       8       64        0      spare rebuilding   /dev/sde</span><br><span class="line">       1       8       32        1      active sync   /dev/sdc</span><br><span class="line">       4       8       48        2      active sync   /dev/sdd</span><br><span class="line"></span><br><span class="line">       0       8       16        -      faulty   /dev/sdb   ← 出错磁盘</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost /]<span class="comment"># mdadm --manage /dev/md0 --remove /dev/sdb            #移除这个坏掉的磁盘</span></span><br><span class="line">mdadm: hot removed /dev/sdb from /dev/md0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost /]<span class="comment"># mdadm --manage /dev/md0 --add /dev/sdb               #添加一个新的磁盘</span></span><br><span class="line">mdadm: added /dev/sdb</span><br></pre></td></tr></table></figure>
<p><br></p>

      
    </div>

    

<!--增加的底部版权代码-->
<div>
      
        
<div class="my_post_copyright">
  <p><span>本文标题:</span><a href="/2018/11/18/Linux 系统管理/Linux高级文件系统管理-8/">Linux高级文件系统管理(8)</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 王瑞 的个人博客">王瑞</a></p>
  <p><span>发布时间:</span>2018年11月18日 - 16:11</p>
  <p><span>最后更新:</span>2019年04月16日 - 20:04</p>
  <p><span>原始链接:</span><a href="/2018/11/18/Linux 系统管理/Linux高级文件系统管理-8/" title="Linux高级文件系统管理(8)">https://www.mkdirs.com/2018/11/18/Linux 系统管理/Linux高级文件系统管理-8/</a>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者</p>
</div>

      
</div>
    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux-系统管理/" rel="tag"> <i class="fa fa-tag"></i> Linux 系统管理</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/18/Linux 系统管理/Linux系统磁盘与分区管理-7/" rel="next" title="Linux系统磁盘与分区管理(7)">
                <i class="fa fa-chevron-left"></i> Linux系统磁盘与分区管理(7)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/11/23/Linux 系统管理/Linux系统Bash的常用功能-9/" rel="prev" title="Linux系统Bash的常用功能(9)">
                Linux系统Bash的常用功能(9) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="王瑞">
            
              <p class="site-author-name" itemprop="name">王瑞</p>
              <div class="site-description motion-element" itemprop="description">记录点滴技术成长之路</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">101</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/lyshark" title="GitHub &rarr; https://github.com/lyshark" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="mailto:1181506874@qq.com" title="E-Mail &rarr; mailto:1181506874@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://plus.google.com/lyshark" title="Google &rarr; https://plus.google.com/lyshark" rel="noopener" target="_blank"><i class="fa fa-fw fa-google"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://twitter.com/lyshark" title="Twitter &rarr; https://twitter.com/lyshark" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="http://wpa.qq.com/msgrd?v=3&uin=1181506874&site=hupaiyule&menu=yes" title="QQ &rarr; http://wpa.qq.com/msgrd?v=3&uin=1181506874&site=hupaiyule&menu=yes" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://weixin.qq.com" title="Wechat &rarr; https://weixin.qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-weixin"></i></a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Quota-磁盘配额配置"><span class="nav-text">Quota 磁盘配额配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#◆检查内核是否支持配额◆"><span class="nav-text">◆检查内核是否支持配额◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆检查指定分区的挂载属性是否满足条件◆"><span class="nav-text">◆检查指定分区的挂载属性是否满足条件◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆quotacheck-生成用户和组的配置文件◆"><span class="nav-text">◆quotacheck 生成用户和组的配置文件◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆edquota-编辑配额文件-设置指定限制大小◆"><span class="nav-text">◆edquota 编辑配额文件,设置指定限制大小◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆启动quota配额管理◆"><span class="nav-text">◆启动quota配额管理◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆关闭quota配额管理◆"><span class="nav-text">◆关闭quota配额管理◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆quota-查看指定用户和组的配额信息◆"><span class="nav-text">◆quota 查看指定用户和组的配额信息◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆repquota-查看指定分区的磁盘配额◆"><span class="nav-text">◆repquota 查看指定分区的磁盘配额◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆setquota-非交互设置磁盘配额命令◆"><span class="nav-text">◆setquota 非交互设置磁盘配额命令◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆磁盘配额小实验◆"><span class="nav-text">◆磁盘配额小实验◆</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LVM-逻辑卷管理器"><span class="nav-text">LVM 逻辑卷管理器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#◆PV-物理卷创建与移除◆"><span class="nav-text">◆PV 物理卷创建与移除◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆VG-卷组创建与移除◆"><span class="nav-text">◆VG 卷组创建与移除◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆LV-逻辑卷创建与移除◆"><span class="nav-text">◆LV 逻辑卷创建与移除◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆LV-容量增加-将LV的容量增加5G的空间-◆"><span class="nav-text">◆LV 容量增加 (将LV的容量增加5G的空间)◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆LV-容量缩小-将LV的容量缩小5G的空间-◆"><span class="nav-text">◆LV 容量缩小(将LV的容量缩小5G的空间)◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆LV-快照功能◆"><span class="nav-text">◆LV 快照功能◆</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RAID-独立磁盘冗余阵列"><span class="nav-text">RAID 独立磁盘冗余阵列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#◆Mdadm-命令解析◆"><span class="nav-text">◆Mdadm 命令解析◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆构建一个RAID-5◆"><span class="nav-text">◆构建一个RAID 5◆</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#◆RAID-仿真救援模式◆"><span class="nav-text">◆RAID 仿真救援模式◆</span></a></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">

<!-- 屏蔽版权开始 -->
&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王瑞</span>
<!-- 屏蔽版权结束 -->

  

  
</div>









        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
