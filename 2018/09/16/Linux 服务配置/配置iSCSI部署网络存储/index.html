<!DOCTYPE html>













<html class="theme-next gemini" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">











<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"hide","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: true,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"expandIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="iSCSI (Internet Small Computer System Interface 互联网小型计算机系统接口) 是由IBM下属的两大研发机构:加利福尼亚AImaden和以色列Haifa研究中心共同开发的,是一个供硬件设备使用的、可在IP协议上层运行的SCSI指令集,是一种开放的基于IP协议的工业技术标准.该协议可以用TCP/IP对SCSI指令进行封装,使得这些指令能够通过基于IP网络进">
<meta name="keywords" content="Linux 服务配置">
<meta property="og:type" content="article">
<meta property="og:title" content="配置iSCSI部署网络存储">
<meta property="og:url" content="https://www.mkdirs.com/2018/09/16/Linux 服务配置/配置iSCSI部署网络存储/index.html">
<meta property="og:site_name" content="我的个人博客">
<meta property="og:description" content="iSCSI (Internet Small Computer System Interface 互联网小型计算机系统接口) 是由IBM下属的两大研发机构:加利福尼亚AImaden和以色列Haifa研究中心共同开发的,是一个供硬件设备使用的、可在IP协议上层运行的SCSI指令集,是一种开放的基于IP协议的工业技术标准.该协议可以用TCP/IP对SCSI指令进行封装,使得这些指令能够通过基于IP网络进">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2019-04-16T12:38:56.710Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="配置iSCSI部署网络存储">
<meta name="twitter:description" content="iSCSI (Internet Small Computer System Interface 互联网小型计算机系统接口) 是由IBM下属的两大研发机构:加利福尼亚AImaden和以色列Haifa研究中心共同开发的,是一个供硬件设备使用的、可在IP协议上层运行的SCSI指令集,是一种开放的基于IP协议的工业技术标准.该协议可以用TCP/IP对SCSI指令进行封装,使得这些指令能够通过基于IP网络进">



  <link rel="alternate" href="/atom.xml" title="我的个人博客" type="application/atom+xml">




  <link rel="canonical" href="https://www.mkdirs.com/2018/09/16/Linux 服务配置/配置iSCSI部署网络存储/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>配置iSCSI部署网络存储 | 我的个人博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">我的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.mkdirs.com/2018/09/16/Linux 服务配置/配置iSCSI部署网络存储/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王瑞">
      <meta itemprop="description" content="记录点滴技术成长之路">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">配置iSCSI部署网络存储

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-16 23:20:08" itemprop="dateCreated datePublished" datetime="2018-09-16T23:20:08+08:00">2018-09-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-04-16 20:38:56" itemprop="dateModified" datetime="2019-04-16T20:38:56+08:00">2019-04-16</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux-服务配置/" itemprop="url" rel="index"><span itemprop="name">Linux 服务配置</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    
    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>iSCSI (Internet Small Computer System Interface 互联网小型计算机系统接口) 是由IBM下属的两大研发机构:加利福尼亚AImaden和以色列Haifa研究中心共同开发的,是一个供硬件设备使用的、可在IP协议上层运行的SCSI指令集,是一种开放的基于IP协议的工业技术标准.该协议可以用TCP/IP对SCSI指令进行封装,使得这些指令能够通过基于IP网络进行传输,从而实现SCSI和TCP/IP协议的连接.对于局域网环境中的用户来说,采用该标准只需要不多的投资就可以方便、快捷地对信息和数据进行交互式传输及管理.</p>
<p>iSCSI技术是一种新储存技术,该技术是将现有SCSI接口与以太网络(Ethernet)技术结合,使服务器可与使用IP网络的储存装置互相交换资料.</p>
<p>设备由 SCSI 总线连接,iSCSI的主要功能是在 TCP/IP 网络上的主机系统 (启动器 initiator) 和存储设备 (目标器 target) 之间进行大量数据的封装和可靠传输过程.此外 iSCSI 提供了在 IP 网络封装 SCSI 命令,且以TCP/IP协议传输.</p>
<a id="more"></a>
<p><br></p>
<p><strong>ISCSI/SAN/NAS常用名词解释</strong></p>
<p><strong>iSCSI：</strong>Internet 小型计算机系统接口 (iSCSI：Internet Small Computer System Interface) Internet 小型计算机系统接口(iSCSI)是一种基于 TCP/IP 的协议,用来建立和管理 IP 存储设备、主机和客户机等之间的相互连接,并创建存储区域网络(SAN).</p>
<p><strong>SAN网络：</strong>Storage Area Network 存储区域网络,多采用高速光纤通道,对速率、冗余性要求高.使用iscsi存储协议块级传输.</p>
<p><strong>NAS网络：</strong>Network Attachment Storage 网络附件存储,采用普通以太网,对速率、冗余无特别要求,使用NFS、CIFS共享协议文件级传输.</p>
<p><strong>SAN和NAS的区别：</strong>SAN一般特指存储网络的构建方式,NAS一般特指产品.SAN有单独的存储网络,NAS使用现有网络,家庭网络存储设备：FREENAS,用的是FREEBSD系统.</p>
<p><strong>NFS 与 ISCSI 的区别</strong></p>
<p>NFS 是以文件为单位的,共享出去的是文件.而ISCSI是以block为单位,共享出去的是设备,端口：3260/tcp.<br><br></p>
<p>iSCSI 网络存储,在工作上分为服务端(target)和客户端(initiator).iSCSI服务端用于存放硬盘存储资源的服务器,能够为用户提供可用的存储资源,iSCSI客户端则是用户使用的软件,用于访问远程服务端的存储资源.</p>
<h2 id="配置iSCSI服务端"><a href="#配置iSCSI服务端" class="headerlink" title="配置iSCSI服务端"></a>配置iSCSI服务端</h2><p>1.通过yum安装iSCSI服务端,此处已安装成功,略过本步骤<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install -y targetd targetcli</span></span><br><span class="line">Loaded plugins: product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager.</span><br><span class="line">Package targetd-0.8.6-1.el7.noarch already installed and latest version</span><br><span class="line">Package targetcli-2.1.fb46-1.el7.noarch already installed and latest version</span><br><span class="line">Nothing to <span class="keyword">do</span></span><br></pre></td></tr></table></figure></p>
<p>2.安装成功后,手动启动iSCSI服务,并设置开机自启动 (注意：iSCSI服务程序为targetd)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># systemctl restart targetd</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl enable targetd</span></span><br></pre></td></tr></table></figure></p>
<p>3.查看iSCSI服务端共享资源,targetcli是用于管理iSCSI服务的专用命令,在执行命令是可看到交互界面.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># targetcli</span></span><br><span class="line">Warning: Could not load preferences file /root/.targetcli/prefs.bin.</span><br><span class="line">targetcli shell version 2.1.fb46</span><br><span class="line">Copyright 2011-2013 by Datera, Inc and others.</span><br><span class="line">For <span class="built_in">help</span> on commands, <span class="built_in">type</span> <span class="string">'help'</span>.</span><br><span class="line"></span><br><span class="line">/&gt; ls</span><br><span class="line">o- / .................................................................... [...]</span><br><span class="line">  o- backstores ......................................................... [...]</span><br><span class="line">  | o- block ............................................................ [Storage Objects: 0]</span><br><span class="line">  | o- fileio ........................................................... [Storage Objects: 0]</span><br><span class="line">  | o- pscsi ............................................................ [Storage Objects: 0]</span><br><span class="line">  | o- ramdisk .......................................................... [Storage Objects: 0]</span><br><span class="line">  o- iscsi .............................................................. [Targets: 0]</span><br><span class="line">  o- loopback ........................................................... [Targets: 0]</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p>
<p>4.进入/backstores/block共享设备位置,并创建共享设备名称 (注意：/backstores/block是iSCSI服务端配置共享设备的位置)<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/&gt; <span class="built_in">cd</span> backstores/block                                   <span class="comment">#进入共享设备位置</span></span><br><span class="line">/backstores/block&gt; create disk0 /dev/sdb                 <span class="comment">#创建共享设备名称 此处将 /dev/sdb 加入到设备中命名为disk0</span></span><br><span class="line">Created block storage object disk0 using /dev/sdb.</span><br><span class="line">/backstores/block&gt; <span class="built_in">cd</span> /                                  <span class="comment">#返回根</span></span><br><span class="line">/&gt; ls</span><br><span class="line">o- / ............................................................. [...]</span><br><span class="line">  o- backstores .................................................. [...]</span><br><span class="line">  | o- block ..................................................... [Storage Objects: 1]</span><br><span class="line">  | | o- disk0 ................................................... [/dev/sdb (20.0GiB) write-thru deactivated]</span><br><span class="line">  | |   o- alua .................................................. [ALUA Groups: 1]</span><br><span class="line">  | |     o- default_tg_pt_gp .................................... [ALUA state: Active/optimized]</span><br><span class="line">  | o- fileio .................................................... [Storage Objects: 0]</span><br><span class="line">  | o- pscsi ..................................................... [Storage Objects: 0]</span><br><span class="line">  | o- ramdisk ................................................... [Storage Objects: 0]</span><br><span class="line">  o- iscsi ....................................................... [Targets: 0]</span><br><span class="line">  o- loopback .................................................... [Targets: 0]</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure></p>
<p>5.创建iSCSI target名称及配置共享资源,iSCSI target 名称是由系统自动生成的,这是一串用于描述共享资源的唯一字符串<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/&gt; <span class="built_in">cd</span> iscsi                                                                 <span class="comment">#进入iSCSI目录</span></span><br><span class="line">/iscsi&gt; create                                                              <span class="comment">#创建target标签</span></span><br><span class="line">Created target iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8.</span><br><span class="line">Created TPG 1.</span><br><span class="line">Global pref auto_add_default_portal=<span class="literal">true</span></span><br><span class="line">Created default portal listening on all IPs (0.0.0.0), port 3260.</span><br><span class="line">/iscsi&gt;</span><br><span class="line">/iscsi&gt; <span class="built_in">cd</span> iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8/     <span class="comment">#进入上面的标签中</span></span><br><span class="line">/iscsi/iqn.20....8c7dcc63aea8&gt; ls                                           <span class="comment">#查看标签内容</span></span><br><span class="line">o- iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8 ........ [TPGs: 1]</span><br><span class="line">  o- tpg1 ............................................................. [no-gen-acls, no-auth]</span><br><span class="line">    o- acls ........................................................... [ACLs: 0]</span><br><span class="line">    o- luns ........................................................... [LUNs: 0]</span><br><span class="line">    o- portals ........................................................ [Portals: 1]</span><br><span class="line">      o- 0.0.0.0:3260 ................................................. [OK]</span><br><span class="line">/iscsi/iqn.20....8c7dcc63aea8&gt; <span class="built_in">cd</span> tpg1/luns                                 <span class="comment">#进入tpg目录</span></span><br><span class="line">/iscsi/iqn.20...ea8/tpg1/luns&gt; create /backstores/block/disk0               <span class="comment">#标签与设备绑定</span></span><br><span class="line">Created LUN 0.</span><br><span class="line">/iscsi/iqn.20...ea8/tpg1/luns&gt;</span><br></pre></td></tr></table></figure></p>
<p>6.配置访问控制列表(ACL),iSCSI设备无需密码进行验证,只需知道标签名称即可通过,因此需要在iSCSI服务端的配置文件中写入一串能够验证信息的名称,这里推荐在系统生成的标签后面加上标识符,:client参数,保证标签唯一性,同时方便区别和管理<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/&gt; <span class="built_in">cd</span> iscsi/iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8     <span class="comment">#进入指定标签</span></span><br><span class="line">/iscsi/iqn.20....8c7dcc63aea8&gt; <span class="built_in">cd</span> tpg1/acls                                 <span class="comment">#进入ACL配置列表</span></span><br><span class="line"></span><br><span class="line">/iscsi/iqn.20...ea8/tpg1/acls&gt; create iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8:client  <span class="comment">#创建用于挂载的标签</span></span><br><span class="line">Created Node ACL <span class="keyword">for</span> iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8:client</span><br><span class="line">Created mapped LUN 0.</span><br><span class="line">/iscsi/iqn.20...ea8/tpg1/acls&gt;</span><br></pre></td></tr></table></figure></p>
<p>7.设置iSCSI服务器的监听IP地址和端口号,即在portals参数目录中写上服务器的IP地址,接下来系统会自动开启服务器192.168.1.20的3260号端口,为外部提供共享存储服务<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/&gt; <span class="built_in">cd</span> /iscsi/iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8/   <span class="comment">#进入操作的标签</span></span><br><span class="line">/iscsi/iqn.20....8c7dcc63aea8&gt; <span class="built_in">cd</span> tpg1/portals/                             <span class="comment">#进入端口配置</span></span><br><span class="line">/iscsi/iqn.20.../tpg1/portals&gt; ls</span><br><span class="line">o- portals ...................................................................... [Portals: 1]</span><br><span class="line">  o- 0.0.0.0:3260 ............................................................... [OK]</span><br><span class="line">/iscsi/iqn.20.../tpg1/portals&gt;</span><br><span class="line">/iscsi/iqn.20.../tpg1/portals&gt; delete 0.0.0.0 3260                          <span class="comment">#删除原有配置</span></span><br><span class="line">Deleted network portal 0.0.0.0:3260</span><br><span class="line">/iscsi/iqn.20.../tpg1/portals&gt; create 192.168.1.20                          <span class="comment">#创建侦听本机</span></span><br><span class="line">Using default IP port 3260</span><br><span class="line">Created network portal 192.168.1.20:3260.</span><br><span class="line">/iscsi/iqn.20.../tpg1/portals&gt; ls</span><br><span class="line">o- portals ...................................................................... [Portals: 1]</span><br><span class="line">  o- 192.168.1.20:3260 .......................................................... [OK]</span><br><span class="line">/iscsi/iqn.20.../tpg1/portals&gt;</span><br></pre></td></tr></table></figure></p>
<p>8.配置全部妥当后检查一下,没问题的话保存.<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/iscsi/iqn.20.../tpg1/portals&gt; <span class="built_in">cd</span> /</span><br><span class="line">/&gt;</span><br><span class="line">/&gt; ls</span><br><span class="line">o- / ................................................................... [...]</span><br><span class="line">  o- backstores ........................................................ [...]</span><br><span class="line">  | o- block ........................................................... [Storage Objects: 1]</span><br><span class="line">  | | o- disk0 ......................................................... [/dev/sdb (20.0GiB) write-thru activated]   <span class="comment">#磁盘名称</span></span><br><span class="line">  | |   o- alua ........................................................ [ALUA Groups: 1]</span><br><span class="line">  | |     o- default_tg_pt_gp .......................................... [ALUA state: Active/optimized]</span><br><span class="line">  | o- fileio .......................................................... [Storage Objects: 0]</span><br><span class="line">  | o- pscsi ........................................................... [Storage Objects: 0]</span><br><span class="line">  | o- ramdisk ......................................................... [Storage Objects: 0]</span><br><span class="line">  o- iscsi ............................................................. [Targets: 1]</span><br><span class="line">  | o- iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8 ..... [TPGs: 1]                                  <span class="comment">#标签名称</span></span><br><span class="line">  |   o- tpg1 .......................................................... [no-gen-acls, no-auth]</span><br><span class="line">  |     o- acls ......................................................................... [ACLs: 1]</span><br><span class="line">  |     | o- iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8:client ......... [Mapped LUNs: 1]          <span class="comment">#自定义标签</span></span><br><span class="line">  |     |   o- mapped_lun0 .............................................................. [lun0 block/disk0 (rw)]</span><br><span class="line">  |     o- luns ......................................................................... [LUNs: 1]</span><br><span class="line">  |     | o- lun0 ..................................................... [block/disk0 (/dev/sdb) (default_tg_pt_gp)]</span><br><span class="line">  |     o- portals ...................................................................... [Portals: 1]</span><br><span class="line">  |       o- 192.168.1.20:3260 .......................................................... [OK]                      <span class="comment">#开启端口</span></span><br><span class="line">  o- loopback ........................................................................... [Targets: 0]</span><br><span class="line">/&gt; <span class="built_in">exit</span></span><br><span class="line">Global pref auto_save_on_exit=<span class="literal">true</span></span><br><span class="line">Last 10 configs saved <span class="keyword">in</span> /etc/target/backup.</span><br><span class="line">Configuration saved to /etc/target/saveconfig.json</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p>9.重启SCSI服务,到此服务器已经配置完毕<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># systemctl restart targetd</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl enable targetd</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="配置Linux客户端"><a href="#配置Linux客户端" class="headerlink" title="配置Linux客户端"></a>配置Linux客户端</h2><p>1.安装iSCSI客户端组件,在RHEL7系统中已经默认集成,如果没有请执行以下步骤,此处就略过<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># yum install -y iscsi-initiator-utils iscsi-initiator-utils-iscsiuio</span></span><br><span class="line">Loaded plugins: product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager .</span><br><span class="line">Package iscsi-initiator-utils-6.2.0.874-7.el7.x86_64 already installed and latest version</span><br><span class="line">Package iscsi-initiator-utils-iscsiuio-6.2.0.874-7.el7.x86_64 already installed and latest version</span><br><span class="line">Nothing to <span class="keyword">do</span></span><br></pre></td></tr></table></figure></p>
<p>2.编辑iSCSI客户端中的initiator名称文件,把服务端的访问控制列表名称填写进来,然后重启iscsid服务程序,并将其加入到开机自启动列表<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/iscsi/initiatorname.iscsi</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># cat /etc/iscsi/initiatorname.iscsi</span></span><br><span class="line">InitiatorName=iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8:client</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl restart iscsid</span></span><br><span class="line">[root@localhost ~]<span class="comment"># systemctl enable iscsid</span></span><br></pre></td></tr></table></figure></p>
<p>3.发现iSCSI服务端存储资源,其中：-m discovery 参数的目的是扫描并发现存储资源,-t st 参数为执行扫描操作的类型,-p 参数后为iSCSI服务端的IP地址<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># iscsiadm -m discovery -t st -p 192.168.1.20            #下图显示,找到一个标签地址</span></span><br><span class="line"></span><br><span class="line">192.168.1.20:3260,1 iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8</span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p>4.接下来准备登陆iSCSI服务器,其中：-m node 参数为将客户端主机作为一台节点服务器,-T iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8 参数为要使用的存储标签,-p 后面为iSCSI服务器的IP地址, –login 参数为登陆服务器,如果加 -u参数为卸载挂载资源<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># iscsiadm -m node -T iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8 -p 192.168.1.20 --login</span></span><br><span class="line"></span><br><span class="line">Logging <span class="keyword">in</span> to [iface: default, target: iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8, portal: 192.168.1.20,3260] (multiple)</span><br><span class="line">Login to [iface: default, target: iqn.2003-01.org.linux-iscsi.localhost.x8664:sn.8c7dcc63aea8, portal: 192.168.1.20,3260] successful.</span><br></pre></td></tr></table></figure></p>
<p>5.此时在iSCSI客户端上会多出一个/dev/sdb磁盘设备文件,接下来我们直接格式化挂在到/network-disk目录下<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost ~]<span class="comment"># ll /dev/sd*</span></span><br><span class="line">brw-rw----. 1 root disk 8,  0 Nov  4 11:45 /dev/sda</span><br><span class="line">brw-rw----. 1 root disk 8,  1 Nov  4 11:45 /dev/sda1</span><br><span class="line">brw-rw----. 1 root disk 8,  2 Nov  4 11:45 /dev/sda2</span><br><span class="line">brw-rw----. 1 root disk 8, 16 Nov  4 12:06 /dev/sdb          <span class="comment">#此处就是远程的磁盘</span></span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mkfs.xfs /dev/sdb                        #格式化这个设备</span></span><br><span class="line"></span><br><span class="line">meta-data=/dev/sdb               isize=512    agcount=4, agsize=1310720 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=5242880, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line"><span class="built_in">log</span>      =internal <span class="built_in">log</span>           bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mkdir /network-disk                     #创建挂载目录</span></span><br><span class="line">[root@localhost ~]<span class="comment"># mount /dev/sdb /network-disk/           #挂载设备</span></span><br><span class="line">[root@localhost ~]<span class="comment">#</span></span><br><span class="line">[root@localhost ~]<span class="comment"># df -h</span></span><br><span class="line">Filesystem             Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/rhel-root   17G  1.2G   16G   7% /</span><br><span class="line">devtmpfs                98M     0   98M   0% /dev</span><br><span class="line">tmpfs                  110M     0  110M   0% /dev/shm</span><br><span class="line">/dev/sda1             1014M  130M  885M  13% /boot</span><br><span class="line">/dev/sr0               4.4G  4.4G     0 100% /mnt</span><br><span class="line">/dev/sdb                20G   33M   20G   1% /network-disk</span><br></pre></td></tr></table></figure></p>
<p>iSCSI客户端经过以上步骤之后,这个设备文件就可以像使用本地磁盘文件一样的操作啦</p>
<p>6.接下来配置一下自动挂载功能,需要注意的是,挂载选项必须为_netdev,写错的话系统无法开机.</p>
<p>由于/dev/sdb/是一个网络设备,而iSCSI是基于TCP/IP网络传输数据的,因此在配置自动挂载是应该加入_netdev参数,说明其是一个网络设备<br><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@localhost /]<span class="comment"># ll /dev/disk/by-uuid/</span></span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Nov  4 11:45 12b3708e-7ca4-4911-bfa2-57b85960e8e5 -&gt; ../../dm-0</span><br><span class="line">lrwxrwxrwx. 1 root root  9 Nov  4 11:45 2018-03-22-19-04-59-00 -&gt; ../../sr0</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Nov  4 11:45 3d4eea6b-1db9-4d30-9174-bfac6faa4cab -&gt; ../../sda1</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Nov  4 11:45 e791c0bf-f6e9-4843-b18d-be40cf3964c2 -&gt; ../../dm-1</span><br><span class="line">lrwxrwxrwx. 1 root root  9 Nov  4 12:08 ff233cc4-2255-4973-a686-9d394384faf6 -&gt; ../../sdb</span><br><span class="line"></span><br><span class="line">[root@localhost /]<span class="comment"># vim /etc/fstab</span></span><br><span class="line">[root@localhost /]<span class="comment"># cat /etc/fstab</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Sat Oct 13 12:32:13 2018</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/dev/mapper/rhel-root   /                       xfs     defaults        0 0</span><br><span class="line">UUID=3d4eea6b-1db9-4d30-9174-bfac6faa4cab /boot                   xfs     defaults        0 0</span><br><span class="line">UUID=ff233cc4-2255-4973-a686-9d394384faf6  /network-disk xfs defaults,_netdev   0 0</span><br><span class="line"></span><br><span class="line">[root@localhost /]<span class="comment"># mount -a</span></span><br></pre></td></tr></table></figure></p>
<p><br></p>
<h2 id="配置Windows客户端"><a href="#配置Windows客户端" class="headerlink" title="配置Windows客户端"></a>配置Windows客户端</h2><p>1.单击控制面板 –&gt; 管理工具 –&gt; iSCSI发起程序</p>
<p>2.在目标选项卡 –&gt; 输入服务器IP地址 –&gt; 单击快速连接</p>
<p>3.选择配置选项卡 –&gt; 单击更改 –&gt; 在标签末尾加上自定义的字符,此处为：client –&gt; 单击确定</p>
<p>4.单击目标选项卡 –&gt; 单击下方的连接按钮</p>
<p>5.单击此电脑 –&gt; 右键选择管理 –&gt; 选择磁盘管理 –&gt; 即可看到磁盘信息<br><br></p>

      
    </div>

    

<!--增加的底部版权代码-->
<div>
      
        
<div class="my_post_copyright">
  <p><span>本文标题:</span><a href="/2018/09/16/Linux 服务配置/配置iSCSI部署网络存储/">配置iSCSI部署网络存储</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 王瑞 的个人博客">王瑞</a></p>
  <p><span>发布时间:</span>2018年09月16日 - 23:09</p>
  <p><span>最后更新:</span>2019年04月16日 - 20:04</p>
  <p><span>原始链接:</span><a href="/2018/09/16/Linux 服务配置/配置iSCSI部署网络存储/" title="配置iSCSI部署网络存储">https://www.mkdirs.com/2018/09/16/Linux 服务配置/配置iSCSI部署网络存储/</a>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者</p>
</div>

      
</div>
    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux-服务配置/" rel="tag"> <i class="fa fa-tag"></i> Linux 服务配置</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/09/16/Linux 服务配置/Rsync+Inotify 实现数据同步/" rel="next" title="Rsync+Inotify 实现数据同步">
                <i class="fa fa-chevron-left"></i> Rsync+Inotify 实现数据同步
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/17/Linux 服务配置/OpenSSH 服务配置与管理/" rel="prev" title="OpenSSH 服务配置与管理">
                OpenSSH 服务配置与管理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="王瑞">
            
              <p class="site-author-name" itemprop="name">王瑞</p>
              <div class="site-description motion-element" itemprop="description">记录点滴技术成长之路</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">101</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">13</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://github.com/lyshark" title="GitHub &rarr; https://github.com/lyshark" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="mailto:1181506874@qq.com" title="E-Mail &rarr; mailto:1181506874@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://plus.google.com/lyshark" title="Google &rarr; https://plus.google.com/lyshark" rel="noopener" target="_blank"><i class="fa fa-fw fa-google"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://twitter.com/lyshark" title="Twitter &rarr; https://twitter.com/lyshark" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="http://wpa.qq.com/msgrd?v=3&uin=1181506874&site=hupaiyule&menu=yes" title="QQ &rarr; http://wpa.qq.com/msgrd?v=3&uin=1181506874&site=hupaiyule&menu=yes" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i></a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                  
                    
                  
                  <a href="https://weixin.qq.com" title="Wechat &rarr; https://weixin.qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-weixin"></i></a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#配置iSCSI服务端"><span class="nav-text">配置iSCSI服务端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Linux客户端"><span class="nav-text">配置Linux客户端</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置Windows客户端"><span class="nav-text">配置Windows客户端</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">

<!-- 屏蔽版权开始 -->
&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王瑞</span>
<!-- 屏蔽版权结束 -->

  

  
</div>









        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
